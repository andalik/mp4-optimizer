<pre>
â–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–‘â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â€ƒâ€ƒâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘
â–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â€ƒâ€ƒâ–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â–‘â–ˆâ–ˆâ•‘â€ƒâ€ƒâ–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â€ƒâ€ƒâ–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â–‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–‘â–‘â–ˆâ–ˆâ•”â•â•â•â–‘â–‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘â–‘â•šâ•â•â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â€ƒâ€ƒâ•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â•šâ•â•â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘
â•šâ•â•â–‘â–‘â–‘â–‘â–‘â•šâ•â•â•šâ•â•â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â•šâ•â•â€ƒâ€ƒâ–‘â•šâ•â•â•â•â•â–‘â•šâ•â•â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â•šâ•â•â–‘â–‘â–‘â•šâ•â•â•šâ•â•â–‘â–‘â–‘â–‘â–‘â•šâ•â•â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â–‘â–‘â•šâ•â•
                                                                                     by Andalik
</pre>

*[English](#english) | [PortuguÃªs (BR)](#portuguÃªs-br)*

---

## English

A sophisticated ZSH script for batch converting MP4 files to HEVC/H.265 format with optimal compression, thermal management, and comprehensive progress tracking. Videos are optimized for maximum Apple device compatibility and streaming performance.

### âœ¨ Features

- **Efficient HEVC Encoding**: Converts MP4 files to HEVC/H.265 using FFmpeg with libx265
- **Apple Device Optimization**: Uses hvc1 tag for maximum compatibility with Apple devices
- **Streaming Optimization**: Applies faststart flag for immediate streaming capabilities
- **Smart CPU Management**: Configurable CPU limits with optional cpulimit integration
- **Thermal Protection**: Automatic pauses between conversions to prevent overheating
- **Adaptive Presets**: Automatically adjusts encoding presets based on system load
- **Progress Tracking**: Beautiful progress bars and real-time system monitoring
- **Error Handling**: Comprehensive logging and automatic cleanup on interruption
- **File Management**: Smart detection of already converted files to avoid duplicates
- **Flexible Sorting**: Multiple sorting options (alphabetical, file size)

### ğŸš€ Quick Start

#### Prerequisites

- **FFmpeg** (required)
- **cpulimit** (optional, for precise CPU control)

##### macOS Installation
```bash
brew install ffmpeg
brew install cpulimit  # Optional
```

##### Linux Installation
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install ffmpeg cpulimit

# CentOS/RHEL/Fedora
sudo dnf install ffmpeg cpulimit
```

#### Usage

1. Place the script in a directory containing MP4 files
2. Make it executable:
   ```bash
   chmod +x mp4-optimizer.zsh
   ```
3. Run the converter:
   ```bash
   ./mp4-optimizer.zsh
   ```

### âš™ï¸ Configuration

Edit the configuration variables at the top of the script:

| Variable | Default | Description |
|----------|---------|-------------|
| `QUALITY_CRF` | 20 | Video quality (18-28, lower = better quality) |
| `PRESET` | "medium" | Encoding speed preset |
| `THREADS` | 0 | Number of threads (0 = auto-detect) |
| `CPU_LIMIT` | 70 | Maximum CPU usage percentage |
| `THERMAL_PAUSE` | 60 | Seconds to pause between conversions |
| `USE_CPULIMIT` | true | Enable precise CPU control |
| `ADAPTIVE_PRESET` | false | Auto-adjust preset based on system load |

#### Quality Settings (CRF)
- **18-22**: Very high quality (larger files)
- **23-28**: Good quality (recommended range)
- **29-35**: Lower quality (smaller files)

#### Encoding Presets
- **ultrafast, superfast, veryfast**: Fast encoding, larger files
- **faster, fast, medium**: Balanced speed/compression (recommended)
- **slow, slower, veryslow**: Best compression, slower encoding

### ğŸ“ File Structure

```
your-directory/
â”œâ”€â”€ mp4-optimizer.zsh             # Main script
â”œâ”€â”€ video1.mp4                    # Original file
â”œâ”€â”€ video1_optimized.mp4          # Converted HEVC file
â”œâ”€â”€ video2.mp4                    # Another original
â”œâ”€â”€ video2_optimized.mp4          # Another converted file
â””â”€â”€ mp4-optimizer-logs/           # Error logs directory
    â”œâ”€â”€ video1_error.log          # Individual error logs
    â””â”€â”€ video2_error.log
```

### ğŸ› Troubleshooting

#### Common Issues

**FFmpeg not found**
```bash
# Install FFmpeg first
brew install ffmpeg  # macOS
sudo apt install ffmpeg  # Ubuntu/Debian
```

**Permission denied**
```bash
chmod +x mp4-optimizer.zsh
```

**High CPU usage**
- Reduce `CPU_LIMIT` value
- Enable `USE_CPULIMIT` and install cpulimit
- Increase `THERMAL_PAUSE` duration

### ğŸ“ˆ Performance Tips

1. **Optimal CRF**: Start with CRF 20-23 for most content
2. **CPU Management**: Use 70-80% CPU limit for background processing
3. **Thermal Management**: Enable thermal pauses for intensive batch jobs
4. **Storage**: Ensure sufficient disk space (HEVC files are typically 30-50% smaller)

---

## PortuguÃªs (BR)

Um script ZSH sofisticado para conversÃ£o em lote de arquivos MP4 para formato HEVC/H.265 com compressÃ£o otimizada, gerenciamento tÃ©rmico e rastreamento abrangente de progresso. Os vÃ­deos sÃ£o otimizados para mÃ¡xima compatibilidade com dispositivos Apple e performance de streaming.

### âœ¨ Funcionalidades

- **CodificaÃ§Ã£o HEVC Eficiente**: Converte arquivos MP4 para HEVC/H.265 usando FFmpeg com libx265
- **OtimizaÃ§Ã£o para Dispositivos Apple**: Usa tag hvc1 para mÃ¡xima compatibilidade com dispositivos Apple
- **OtimizaÃ§Ã£o para Streaming**: Aplica flag faststart para capacidades de streaming imediato
- **Gerenciamento Inteligente de CPU**: Limites de CPU configurÃ¡veis com integraÃ§Ã£o opcional do cpulimit
- **ProteÃ§Ã£o TÃ©rmica**: Pausas automÃ¡ticas entre conversÃµes para prevenir superaquecimento
- **Presets Adaptativos**: Ajusta automaticamente os presets de codificaÃ§Ã£o baseado na carga do sistema
- **Rastreamento de Progresso**: Barras de progresso elegantes e monitoramento do sistema em tempo real
- **Tratamento de Erros**: Logging abrangente e limpeza automÃ¡tica em caso de interrupÃ§Ã£o
- **Gerenciamento de Arquivos**: DetecÃ§Ã£o inteligente de arquivos jÃ¡ convertidos para evitar duplicatas
- **OrdenaÃ§Ã£o FlexÃ­vel**: MÃºltiplas opÃ§Ãµes de ordenaÃ§Ã£o (alfabÃ©tica, tamanho do arquivo)

### ğŸš€ InÃ­cio RÃ¡pido

#### PrÃ©-requisitos

- **FFmpeg** (obrigatÃ³rio)
- **cpulimit** (opcional, para controle preciso de CPU)

##### InstalaÃ§Ã£o no macOS
```bash
brew install ffmpeg
brew install cpulimit  # Opcional
```

##### InstalaÃ§Ã£o no Linux
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install ffmpeg cpulimit

# CentOS/RHEL/Fedora
sudo dnf install ffmpeg cpulimit
```

#### Uso

1. Coloque o script em um diretÃ³rio contendo arquivos MP4
2. Torne-o executÃ¡vel:
   ```bash
   chmod +x mp4-optimizer.zsh
   ```
3. Execute o conversor:
   ```bash
   ./mp4-optimizer.zsh
   ```

### âš™ï¸ ConfiguraÃ§Ã£o

Edite as variÃ¡veis de configuraÃ§Ã£o no topo do script:

| VariÃ¡vel | PadrÃ£o | DescriÃ§Ã£o |
|----------|---------|-----------|
| `QUALITY_CRF` | 20 | Qualidade do vÃ­deo (18-28, menor = melhor qualidade) |
| `PRESET` | "medium" | Preset de velocidade de codificaÃ§Ã£o |
| `THREADS` | 0 | NÃºmero de threads (0 = auto-detectar) |
| `CPU_LIMIT` | 70 | Percentual mÃ¡ximo de uso de CPU |
| `THERMAL_PAUSE` | 60 | Segundos de pausa entre conversÃµes |
| `USE_CPULIMIT` | true | Habilitar controle preciso de CPU |
| `ADAPTIVE_PRESET` | false | Auto-ajustar preset baseado na carga do sistema |

#### ConfiguraÃ§Ãµes de Qualidade (CRF)
- **18-22**: Qualidade muito alta (arquivos maiores)
- **23-28**: Boa qualidade (faixa recomendada)
- **29-35**: Qualidade menor (arquivos menores)

#### Presets de CodificaÃ§Ã£o
- **ultrafast, superfast, veryfast**: CodificaÃ§Ã£o rÃ¡pida, arquivos maiores
- **faster, fast, medium**: Velocidade/compressÃ£o balanceada (recomendado)
- **slow, slower, veryslow**: Melhor compressÃ£o, codificaÃ§Ã£o mais lenta

### ğŸ“ Estrutura de Arquivos

```
seu-diretorio/
â”œâ”€â”€ mp4-optimizer.zsh             # Script principal
â”œâ”€â”€ video1.mp4                    # Arquivo original
â”œâ”€â”€ video1_optimized.mp4          # Arquivo HEVC convertido
â”œâ”€â”€ video2.mp4                    # Outro arquivo original
â”œâ”€â”€ video2_optimized.mp4          # Outro arquivo convertido
â””â”€â”€ mp4-optimizer-logs/           # DiretÃ³rio de logs de erro
    â”œâ”€â”€ video1_error.log          # Logs de erro individuais
    â””â”€â”€ video2_error.log
```

### ğŸ› SoluÃ§Ã£o de Problemas

#### Problemas Comuns

**FFmpeg nÃ£o encontrado**
```bash
# Instale o FFmpeg primeiro
brew install ffmpeg  # macOS
sudo apt install ffmpeg  # Ubuntu/Debian
```

**PermissÃ£o negada**
```bash
chmod +x mp4-optimizer.zsh
```

**Alto uso de CPU**
- Reduza o valor de `CPU_LIMIT`
- Habilite `USE_CPULIMIT` e instale cpulimit
- Aumente a duraÃ§Ã£o de `THERMAL_PAUSE`

### ğŸ“ˆ Dicas de Performance

1. **CRF Ã“timo**: Comece com CRF 20-23 para a maioria dos conteÃºdos
2. **Gerenciamento de CPU**: Use limite de 70-80% de CPU para processamento em segundo plano
3. **Gerenciamento TÃ©rmico**: Habilite pausas tÃ©rmicas para trabalhos intensivos em lote
4. **Armazenamento**: Garanta espaÃ§o suficiente em disco (arquivos HEVC sÃ£o tipicamente 30-50% menores)

---

## ğŸ¤ Contributing | Contribuindo

Contributions are welcome! Please feel free to submit issues, feature requests, or pull requests.

ContribuiÃ§Ãµes sÃ£o bem-vindas! Sinta-se livre para enviar issues, solicitaÃ§Ãµes de funcionalidades ou pull requests.

## ğŸ“„ License | LicenÃ§a

This project is open source and available under the [MIT License](LICENSE).

Este projeto Ã© open source e estÃ¡ disponÃ­vel sob a [LicenÃ§a MIT](LICENSE).

## ğŸ™ Acknowledgments | Agradecimentos

- Built with [FFmpeg](https://ffmpeg.org/) - the Swiss Army knife of video processing
- Uses [libx265](https://x265.readthedocs.io/) for HEVC encoding
- Inspired by the need for efficient video compression workflows

---

- ConstruÃ­do com [FFmpeg](https://ffmpeg.org/) - o canivete suÃ­Ã§o do processamento de vÃ­deo
- Usa [libx265](https://x265.readthedocs.io/) para codificaÃ§Ã£o HEVC
- Inspirado pela necessidade de fluxos de trabalho eficientes de compressÃ£o de vÃ­deo